{% extends "base.html" %} {% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Header Section -->
  <div class="dashboard-header mb-8 animate-on-scroll">
    <div class="glass rounded-2xl p-8 mb-6">
      <div
        class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4"
      >
        <div>
          <h2 class="text-3xl font-bold text-brown-800 mb-2">Documentations</h2>
          <p class="text-brown-600">
            Manage and organize your documents efficiently
          </p>
        </div>
        <a
          href="{{ url_for('add_doc') }}"
          class="btn-primary-custom px-6 py-3 rounded-lg font-semibold shadow-lg hover:shadow-xl transition-all duration-300 flex items-center space-x-2"
        >
          <span>+</span>
          <span>Add New Documentation</span>
        </a>
      </div>
    </div>
  </div>

  <!-- User Info Section -->
  <div class="user-info mb-8 animate-on-scroll" style="animation-delay: 0.2s">
    <div
      class="bg-white rounded-2xl p-6 shadow-lg border-l-4 border-yellow-500"
    >
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold text-brown-800 mb-2 flex items-center">
            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
            Viewing Permissions
          </h3>
          <p class="text-brown-600">
            <strong>All documents</strong> (both yours and others)
          </p>
        </div>
        <div>
          <h3 class="font-semibold text-brown-800 mb-2 flex items-center">
            <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
            Your Permissions
          </h3>
          <p class="text-brown-600">
            {% if session.role == 'admin' %}
            <span class="text-green-600 font-semibold">Full Access:</span> Add,
            Read, Edit, and Delete ALL documents {% else %}
            <span class="text-blue-600 font-semibold">Limited Access:</span> Add
            new documents and Read ALL documents. Cannot Edit or Delete any
            documents. {% endif %}
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Documents Grid -->
  <div class="docs-list">
    {% if docs %}
    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
      {% for doc_data in docs %} {% set doc = doc_data.doc %}
      <div
        class="doc-card animate-on-scroll"
        style="animation-delay: {{ loop.index0 * 0.1 }}s;"
      >
        <div class="p-6">
          <!-- Header -->
          <div class="doc-header mb-4">
            <div class="flex justify-between items-start mb-3">
              <h3 class="text-xl font-semibold text-brown-800 pr-2">
                <a
                  href="{{ url_for('view_doc', doc_id=doc.id) }}"
                  class="doc-title-link hover:text-yellow-600 transition-colors duration-300"
                >
                  {{ doc.title }}
                </a>
              </h3>
              <div class="flex flex-col items-end space-y-2">
                <span class="badge-custom"> {{ doc.doc_type|upper }} </span>
                {% if doc.user_id == session.user_id %}
                <span
                  class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full"
                >
                  Your Document
                </span>
                {% else %}
                <span
                  class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full"
                >
                  By: {{ doc.author.username }}
                </span>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Metadata -->
          <div class="doc-meta mb-4 text-sm text-brown-600 space-y-1">
            <p><strong>Created By:</strong> {{ doc.author.username }}</p>
            <p>
              <strong>Created:</strong> {{ doc.created_at.strftime('%Y-%m-%d
              %H:%M') }}
            </p>
          </div>

          <!-- Image Preview -->
          {% if doc_data.image_preview %}
          <div class="doc-content-preview mb-4">
            <p class="text-sm font-semibold text-brown-700 mb-2">
              Image Preview:
            </p>
            <div class="image-preview bg-gray-100 rounded-lg p-2">
              <img
                src="data:image/jpeg;base64,{{ doc_data.image_preview }}"
                alt="{{ doc.title }}"
                class="rounded-lg shadow-md mx-auto transform hover:scale-105 transition-transform duration-300"
              />
            </div>
          </div>
          {% endif %}

          <!-- Download Section -->
          <div class="doc-file-actions mb-4">
            <p class="text-sm font-semibold text-brown-700 mb-3">
              Download Options:
            </p>
            <div class="download-buttons grid grid-cols-2 gap-2">
              {% if doc.file_path %}
              <a
                href="{{ url_for('download_file', doc_id=doc.id) }}"
                class="btn-secondary-custom text-center py-2 px-3 rounded text-xs font-medium transition-all duration-300 hover:shadow-md"
              >
                游닌 Original {{ doc.doc_type|upper }}
              </a>
              {% if doc.doc_type != 'pdf' %}
              <a
                href="{{ url_for('convert_doc', doc_id=doc.id, target_format='pdf') }}"
                class="bg-red-500 hover:bg-red-600 text-white text-center py-2 px-3 rounded text-xs font-medium transition-all duration-300 hover:shadow-md"
              >
                游닌 as PDF
              </a>
              {% endif %} {% if doc.doc_type != 'excel' %}
              <a
                href="{{ url_for('convert_doc', doc_id=doc.id, target_format='excel') }}"
                class="bg-green-500 hover:bg-green-600 text-white text-center py-2 px-3 rounded text-xs font-medium transition-all duration-300 hover:shadow-md"
              >
                游닌 as Excel
              </a>
              {% endif %} {% if doc.doc_type != 'word' %}
              <a
                href="{{ url_for('convert_doc', doc_id=doc.id, target_format='word') }}"
                class="bg-blue-500 hover:bg-blue-600 text-white text-center py-2 px-3 rounded text-xs font-medium transition-all duration-300 hover:shadow-md"
              >
                游닌 as Word
              </a>
              {% endif %} {% else %}
              <a
                href="{{ url_for('convert_doc', doc_id=doc.id, target_format='pdf') }}"
                class="bg-red-500 hover:bg-red-600 text-white text-center py-2 px-3 rounded text-xs font-medium transition-all duration-300 hover:shadow-md col-span-2"
              >
                游닌 as PDF
              </a>
              <a
                href="{{ url_for('convert_doc', doc_id=doc.id, target_format='excel') }}"
                class="bg-green-500 hover:bg-green-600 text-white text-center py-2 px-3 rounded text-xs font-medium transition-all duration-300 hover:shadow-md"
              >
                游닌 as Excel
              </a>
              <a
                href="{{ url_for('convert_doc', doc_id=doc.id, target_format='word') }}"
                class="bg-blue-500 hover:bg-blue-600 text-white text-center py-2 px-3 rounded text-xs font-medium transition-all duration-300 hover:shadow-md"
              >
                游닌 as Word
              </a>
              {% endif %}
            </div>
          </div>

          <!-- Actions -->
          <div class="doc-actions border-t border-gray-200 pt-4 mt-4">
            <div class="flex justify-between items-center">
              <a
                href="{{ url_for('view_doc', doc_id=doc.id) }}"
                class="btn-secondary-custom px-4 py-2 rounded text-sm font-medium"
              >
                View Details
              </a>

              {% if session.role == 'admin' %}
              <div class="flex space-x-2">
                <a
                  href="{{ url_for('edit_doc', doc_id=doc.id) }}"
                  class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded text-sm font-medium transition-colors duration-300"
                >
                  Edit
                </a>
                <form
                  method="POST"
                  action="{{ url_for('delete_doc', doc_id=doc.id) }}"
                  class="delete-form"
                  onsubmit="return confirm('Are you sure you want to delete this document?');"
                >
                  <button
                    type="submit"
                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded text-sm font-medium transition-colors duration-300"
                  >
                    Delete
                  </button>
                </form>
              </div>
              {% else %}
              <span class="text-gray-500 text-sm italic">Read Only</span>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16 animate-on-scroll">
      <div class="max-w-md mx-auto">
        <div class="floating mb-6">
          <div
            class="w-24 h-24 bg-yellow-100 rounded-full flex items-center justify-center mx-auto"
          >
            <span class="text-4xl">游늯</span>
          </div>
        </div>
        <h3 class="text-2xl font-bold text-brown-800 mb-4">No documents yet</h3>
        <p class="text-brown-600 mb-6">
          Start by adding your first documentation to get started.
        </p>
        <a
          href="{{ url_for('add_doc') }}"
          class="btn-primary-custom px-8 py-3 rounded-lg font-semibold inline-block"
        >
          Create Your First Document
        </a>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
